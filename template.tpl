___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Expertflow Live Chat",
  "categories" : ["CHAT","SOCIAL","SALES"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAABHNCSVQICAgIfAhkiAAABvlJREFUeF7tXE1sVUUUHha4sIphYTWhNQobahs2Yku7EUj6IAEWxBZcuLEPdYWhZYMJSKsksrE1sPKnuGFhAcOCktg2UVxYKOpCQpGNYNKaaEkwKrjQhc73kmue72/OzJx558WeSZou3sycM993z7nz891Z8bctRosYAiuUADHsC4aVAFn8lQBh/JUAJUAaAWH7+g5QAoQREDavEaAECCMgbF4jQAkQRkDYvEaAEiCMgLB5jQAlQBgBYfNJI+DM57fMp3ML5vL1n8xv9/8qG2r7U6tNd8djZt/ONtPa3BQFBWyd+ex7a+dPM3/7l6i+ssYt1qce61//lnWF/ylKEgJ+tSDkj39hgf+Z7PNIfqMlYj25flbxugU7f/ySWVy6793Wp8G+XevNyMBGnyakuuwEAPxNr56v+MS7PMpbAt60RFALwO8/Mh1ki2qjuB6i9dxbvSFNq7ZhJ6DvyIzXk1/q2fih58z2rlbSILss0amf/FJHhvZuMAdf2EDyj1KJlYAJm4OHTl6m2K1aB3l37r3dzj44bDmNVKlwxfoX+87KumYl4KW3L5npq4uh4/q3nSsKFmy+zw1N1i31lA5oeOAZ8/KutuhxogNWAtpenGADBWGOnFtaAP7R8a/Y7ISgmOtsMR+9vjmkaVkbVgLW7D7N4lSjd7Kpvdl8cizH4mbDEoBB9nQ8XjZIzLIw3//9j/J1BQsihE4algCud4Arx2L6uW3oIgGqNFU4Z0KsEcAxM1nzaJO5+r57FvTOx9fM6MS1NAg7ep0a3WE67Cqeo7ASAIc6XzlvfrwTviod3d9t9m5d5xwbUlHv4MUoW04jFSr0b1lr3n2tJ6RpxTbsBCA99B2eDsrRvoOLsRWCIKJzZmyHeaTpgZDm9SEAVkKA8QU/G02IrRD0nn5ytTl3rJcVfPjBHgHZ4JAiPrxw0+C9UCslYU6NRU3MbiPVVijw2IijpMWQ/pMRUOwMAKq0RRwDeq3BznrswtbqJ5V/xTbrQkDIk7Fc2igBwkwrAUqAMALC5jUClABhBITNawQoAcIICJtPGgFYgE3ZI8r523fLFmKr7H4KdhRzna0sO4uwddZqg6AL4liIZf5Bu7TN+piqJCMAW8UfXPiOdHSIo8dhq7kJ2eIF8OOTN8m2QoCEUACaIKpaw8dGEgIGT87aU6tbPn6YVU0rzfihzV57QgC/38pguJRwLoepW+WufpJuRbwx/nXhiQwpIGF6dCdZ8hGrQQrx0aXY8O2TNQKgWIAqLqZQ1WfI83j6612ouiWqX6wExDz9xQ5ThE85eyZcr9RTCiZnFLASwCUVxMwDL+VK28GIstGJb73fMdQnklIv9PCoUt+sBKguiELff+s0LAEPP7jSIBJKCyIg5tDfH6LyFg2rC4JK4cYP8R9HIMTxvUC1w2+sL4ZPfcOBZVAfvjL6WkZYI4DjJYwnf87qglzKAy4RWAgDDfsSRnroHZwMkqRkQFCfLqlpKFU4RiWWNQJgNEYd5yv94Ig4KlBZPU5VHPpkJwCdhsgGAf6YVZz57gcdODFb2IRLXZAa8V7ilqckIQBgIEUAHMqMBWkH3wO48n41kBF1IJ1iK4QozHpG8s96PxwUW8kIyIxDueb6TDUU+NIBgnSfLzNdAGFvanvXE+S9KVd/yRdiIQ4s9zbJI2C5A+wavxLgQijx70pAYoBd3SsBLoQS/64EJAbY1b0S4EIo8e9KQGKAXd0nJwDKBWxR4/gQmp2stDQ/VFjgdLfz3cODzcDFO/fKbLlAqPR7Cv/quhCjHh1itYlPlLAdEboixgoYOiTOVXAGFod/tR6AJBEAQHCJUqVbsqo5g9Ovs/YuHl8SYnZffSID/kG3xHVLSmabnYCYS5R8SagX+BlYvv5RCGYnIFYuQj2Q4dAgUQAqrcOpiEDfrATggj7cFRdTkHOhC3KlogFrZ8rakyg3Tu9x+kf1i5UArsORPVvXmrH91a8DqHfqKQWTUyPKSsDz9oqCK/NLVPJr1suujGy109WsYEqLmY6UIi7zo2FvS+EkgIXFRJ00LAFcUhEoD3AjSTVp4oETX7JFWghHrvuMfPpkTUFcuZmiPOASgfmAldWliIep/bISgBzdZe8LirlOjCr7k9IFUf0TIQBGY2SDkH7MjNE/0JB451Cikwo++zogMxw6HfWd3iHi+g7PsOhRKaD5+kfpkzUFFRtEJECrQ0lHeOmesvdw+oqyYA8kHLWfRaUUZ9WaFFBArlUnGQEZOFgd4694KzpzCHN8fHnI8fUhtiZwneXC0r3CH0fh9K+aP0kJ4ADh/96HEiDMsBKgBAgjIGxeI0AJEEZA2LxGgBIgjICweY0AJUAYAWHzGgFKgDACwuY1ApQAYQSEzWsEKAHCCAib/wegzDcdmxBHtwAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "Use this tag template to set up live chat on your website connecting customers to the business for inbound, outbound, and self-service interactions. For additional information, see www.expertflow.com.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "initWidgetUrl",
    "displayName": "Init-Widget Url",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "valueHint": "eg: https://example.com",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "customerWidgetUrl",
    "displayName": "Customer WIdget Url",
    "simpleValueType": true,
    "valueHint": "eg: https://example.com/customer-widget/",
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "widgetIdentifier",
    "displayName": "Widget Identifier",
    "simpleValueType": true,
    "valueHint": "eg: web/chat/mobile",
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "serviceIdentifier",
    "displayName": "Service Identifier",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "valueHint": "eg: +123456",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "NUMBER"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// CIM template script 

const setInWindow = require('setInWindow');
const copyFromWindow = require('copyFromWindow');
const injectScript = require('injectScript');

var __cim = copyFromWindow('__cim') || {};

__cim.initWidgetUrl = data.initWidgetUrl;
__cim.customerWidgetUrl = data.customerWidgetUrl;
__cim.widgetIdentifier = data.widgetIdentifier;
__cim.serviceIdentifier = data.serviceIdentifier;

setInWindow('__cim', __cim);

const initUrl = __cim.initWidgetUrl+'/init_widget.js';

injectScript(initUrl, data.gtmOnSuccess, data.gtmOnFailure, 'initUrl');

// End CIM template script


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "__cim"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://web-init-widget.web.app/init_widget.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Data Set Test
  code: |-
    const setInWindow = require('setInWindow');
    const copyFromWindow = require('copyFromWindow');

    var __cim = copyFromWindow('__cim') || {};

    __cim.initWidgetUrl = 'https://web-init-widget.web.app';
    __cim.customerWidgetUrl = 'https://cim.expertflow.com/customer-widget';
    __cim.widgetIdentifier = 'web';
    __cim.serviceIdentifier = '+921218';

    setInWindow('__cim', __cim);
- name: Script Injection Test
  code: "const injectScript = require('injectScript');\n \nlet initWidgetUrl = 'https://web-init-widget.web.app';\n\
    \nconst initUrl = initWidgetUrl+'/init_widget.js';\n\ninjectScript(initUrl, data.gtmOnSuccess,\
    \ data.gtmOnFailure, 'initUrl');"


___NOTES___

Created on 12/17/2021, 10:28:17 PM


